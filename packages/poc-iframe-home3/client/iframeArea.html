<template name="iframeHome3">
	<section class="page-container">
		<header class="fixed-title">
<!--			<h2>my Home</h2> -->
		</header>

		<div class="iframe-home3">
			
			<div class="container-fluid">
				<div class="row">
							<div class="col-sm-8 col-sm-offset-2">
									<form class="navbar-form" role="search">
											<div class="form-group row">
													<input type="text" class="form-control col-sm-11" placeholder="Ricerca">
											</div>
											<button type="submit" class="btn btn-default cerca col-sm-1"><i class="fa fa-search"></i></button>
									</form>
							</div>
							<div class="col-sm-3">
							</div>
				</div>
        
				<div class="row">
						<div class="col-sm-4 home-box">
								<div class="home-box-content">
								<h2 class="home-box-title"><a href="https://sogo.fabbricadigitale.it/SOGo/Mail">myMAIL</a></h2>
										<div class="lista-principale">
														<p><a href="https://sogo.fabbricadigitale.it/SOGo/Mail"><i class="fa fa-envelope"></i><span>3</span> nuove email da <span>fabbricadigitale</span></a></p>
														<p><i class="fa fa-envelope"></i><span>1</span> report settimanale da <span>Gino Verdi</span></p>
														<p><i class="fa fa-fax"></i><span>1</span> nuovi fax da <span>Mario Rossi</span></p>
														<p><i class="fa fa-phone"></i><span>2</span> Chiamate perse da <span>Viola Prati</span></p>
										</div>
								</div>
						</div>
            
						<div class="col-sm-4 home-box">
								<div class="home-box-content">
								<h2 class="home-box-title"><a href="https://sogo.fabbricadigitale.it/SOGo/Calendar/">myTASK</a></h2>
										<div class="lista-principale" id="mytask">
											 
										</div>
								</div>
						</div>
						
						<div class="col-sm-4 home-box">
								<div class="home-box-content">
										<h2 class="home-box-title"><a href="https://drive.fabbricadigitale.it">myDRIVE</a></h2>
										<div class="lista-principale">
												<div class="progress">
														<div class="progress-bar" id="progressbar" role="progressbar" aria-valuenow="70" aria-valuemin="0" aria-valuemax="100">
													 
														</div>
												</div>
												<h4>Spazio libero: <span id="freespace"></span></h4>
												<h4>Spazio totale: <span id="totalspace"></span></h4>
										</div>
								</div>
						</div>
				</div> 
        
           <div class="row">
                <div class="col-sm-6 home-box hidden">
                    <div class="home-box-content">
                        <h2 class="home-box-title">ACTIVITY STREAM</h2>
                        <ul class="lista-principale">
                            <li><i class="fa fa-comment"></i><span>Nuovi messaggi</span> nei canali:</li>
                            <li>
							    <ul class="lista-secondaria">
                                    <li><i class="fa fa-comment"></i>3 nuovi messaggi in <span>General</span></li>
                                </ul>
						    </li>
                            <li><i class="fa fa-quote-left"></i><span>Menzioni</span>:</li>
						    <li>
                                <ul class="lista-secondaria">
                                    <li><i class="fa fa-user"></i><span>Viola Prati</span> ti ha menzionato nel canale <span>General</span></li>
                                    <li><i class="fa fa-user"></i><span>Mario Rossi</span> ti ha menzionato nel canale <span>General</span></li>                                
                                </ul>
						    </li>
						    <li><i class="fa fa-comments"></i><span>Messaggi diretti</span></li>
						    <li>
							    <ul class="lista-secondaria">
                                    <li><i class="fa fa-comments"></i>1 nuovo messaggio diretto da <span>Giovanna Goi</span></li>
                                </ul>
						    </li>
                        </ul>
                    </div>
                </div>
        
                <div class="col-sm-8 home-box">
                    <div class="home-box-content">
                    <h2 class="home-box-title"><a href="https://socialmail.multiux.com/SOGo/so/sogo1/Contacts/">myCONTACTS</a></h2>
				    <div class="table-responsive">
					    <table class="table"> 
						    <thead> 
							    <tr> 
								    <th>#</th> 
								    <th>USERNAME</th> 
								    <th>NOME</th> 
								    <th>COGNOME</th> 
								    <th>EMAIL</th> 
							    </tr> 
						    </thead> 
						    <tbody id="mycontact"> 
								   
							</tbody> 
					    </table>
				    </div>
                
                    </div>
                </div>
            
                <div class="col-sm-4 home-box">
                </div>

     	    </div> 
        </div>
		<script>
				var Home = function () {
					return {
							url: "https://c4c.fabbricadigitale.it/openuc",
							init: function () {
								
									//Home.getLastMail();
									Home.getLastCal();
									Home.getDrive();
									Home.getContacts();
							},
							getFromCookies: function (cookie) {
									var res = $.cookie(cookie);
									console.log(res);
									return res;
							},
							getLastMail: function () {
								
									$.ajax({
											type: "GET",
											url: Home.url + "/mymail",
											contentType: "application/json; charset=utf-8",
											headers: {
													"x-auth-token": Home.getFromCookies("rc_token"),
													"x-user-id": Home.getFromCookies("rc_uid")
											},
											success: function (data, status, xhr) {
													var ds = new kendo.data.DataSource({
															data: data.data
													});
													$("#mytask").kendoListView({
															dataSource: ds,
															template: kendo.template($("#taskTMP").html())
													})
											},
											error: function (xhr, status, errorThrown) {
											}
									});
									return deferred.promise();
							},
							getLastCal: function () {
									debugger
									$.ajax({
											type: "GET",
											url: Home.url + "/mytask",
											contentType: "application/json; charset=utf-8",
											headers: {
													"x-auth-token": Home.getFromCookies("rc_token"),
													"x-user-id": Home.getFromCookies("rc_uid")
											},
											success: function (data, status, xhr) {
													var ds = new kendo.data.DataSource({
															data: data.data
													});
													$("#mytask").kendoListView({
															dataSource: ds,
															template: kendo.template($("#taskTMP").html())
													})
											},
											error: function (xhr, status, errorThrown) {
													//todo
											}
									});
							},
							getDrive: function () {
									$.ajax({
											type: "GET",
											url: Home.url + "/mydrive",
											contentType: "application/json; charset=utf-8",
											headers: {
													"x-auth-token": Home.getFromCookies("rc_token"),
													"x-user-id": Home.getFromCookies("rc_uid")
											},
											success: function (data, status, xhr) {                    
													$("#progressbar").css("width", data.data.percentage + "%");
													$("#progressbar").text(Home.formatBytes(data.data.size));

													$("#totalspace").text(Home.formatBytes(data.data.quota));
													var free = data.data.quota - data.data.size;
													$("#freespace").text(Home.formatBytes(free));
											},
											error: function (xhr, status, errorThrown) {
													//todo
											}
									});
							},
							getContacts: function () {
									$.ajax({
											type: "GET",
											url: Home.url + "/mycontact",
											contentType: "application/json; charset=utf-8",
											headers: {
													"x-auth-token": Home.getFromCookies("rc_token"),
													"x-user-id": Home.getFromCookies("rc_uid")
											},
											success: function (data, status, xhr) {
													var ds = new kendo.data.DataSource({
															data: data.data
													});
													$("#mycontact").kendoListView({
															dataSource: ds,
															template: kendo.template($("#contTMP").html())
													})
											},
											error: function (xhr, status, errorThrown) {
													//todo
											}
									});
							},
							formatBytes: function (bytes, decimals) {
								 
								 if(bytes == 0) return '0 Byte';
											var k = 1000;
											var dm = decimals + 1 || 3;
											var sizes = ['Bytes', 'KB', 'MB', 'GB', 'TB', 'PB', 'EB', 'ZB', 'YB'];
											var i = Math.floor(Math.log(bytes) / Math.log(k));
											return parseFloat((bytes / Math.pow(k, i)).toFixed(dm)) + ' ' + sizes[i];
									}
					}
			}();
		
	    $(document).ready(function() {
		    Home.init()
	    })
    </script>
    <script type="text/x-kendo-tmpl" id="taskTMP">
        
        # $.each(events, function(index, element) { #       
            <p>     
                <a href="#">
                    <i class="fa fa-clock-o"></i>
                    <span># kendo.parseDate(element.startDate) #</span>
                    element.title
                </a>
            </p>
        # }) #        
        # $.each(todos, function(index, element) { #    
            <p>         
                <a href="#">
                    <i class="fa fa-tasks"></i>
                    <span># kendo.parseDate(element.startDate) #</span>
                    element.title
                </a>
             </p>
        # }) #       
       
    </script>
    <script type="text/x-kendo-tmpl" id="contTMP">
        <tr> 
					<td scope="row"><i class="fa fa-user"></i></th> 
					<td>${username}</td> 
					<td>${firstname}</td> 
						<td>${lastName}</td> 
					<td>${email}</td> 
				</tr> 
    </script>
		
		</div>
	</section>
</template>
